'\" t
.TH DUMP.SH 8 "14 Mar 2006" "@PACKAGE_VERSION@" "@PACKAGE_NAME@ utils"

.SH NAME
dump.sh \- dump a filesystem for a specifc host

.SH SYNOPSIS
.B dump.sh
[
.IR OPTIONS
]
DIR|FILE
[
DIR|FILE
]

.SH DESCRIPTION
\fBdump.sh\fR is a frontend for `mirror.pl' and `rdup'. It will backup
all directories and files given on the command line. It tries to be smart with
respect to a full dump or an incremental dump. If the directories to
be backed up \fIdo not exist\fR in the backup directory a full dump
is assumed. Otherwise an incremental dump is performed.
.PP
Making local backups is as simple as:
      dump.pl -b /vol/backup/$HOST ~ 
.PP
\fB~\fR is the directory to be backed up. Multiple directories
or files are allowed on the command line.
.PP
There is no default backup location. You must specify a \-b argument.
.PP
See mirror.sh(8) for more information on how the files are placed
in the backup.

.SH OPTIONS
.TP 
.B \-b backupdir
The backup directory. You can specify this option multiple times, this
will make the backup to be written to all these directories in one go.

Note that the \-e option for instance will only be looking at the first
directory specified.
.TP
.B \-N name
The \fIname\fR speficies an optional prefix for the
timestamp and filelist files. These are stored, by default, in
`@sysconfdir@/rdup'. With the \fB\-e\fR option you can store them
with your backup. 

Normally the filelist and timestamp files are named like this:

$HOSTNAME.`basename DIR`.list and
$HOSTNAME.`basename DIR`.timestamp

where DIR is the first directory or file on the command line. Thus:
\fBdump.sh\fR /home/miekg/bin, will lead to the following names:

elektron.bin.list and
elektron.bin.timestamp

.TP
.B \-c user@remotehost
Restore a backup on a remote host. This will create a pipeline of the
form: 

rdup \-c \fIDIR|FILE\fR | ssh \fIuser@remotehost\fR mirror.sh \-c \-b \fIbackupdir\fR

There is no provisioning for \fBssh\fR so unless you have configured
\fBssh\fR to work without a passphrase you will be asked to supply one.
Also note that the PATH on the remote host should be set in such a way that all
the rdup-util scripts can be found.
.TP
.B \-k keyfile
Encrypt the files while backing up with \fIkeyfile\fR. This option
inserts \fBcrypt.sh keyfile\fR in the pipeline. If both \fI-z\fR and
\fI-k\fR are given a file is first zipped and then encrypted.
.TP
.B -l num
Limit the transfer to 'num' bytes/second. This option is given to 
\fBcstream\fR. See the manual page of cstream at the \-t option.
.TP
.B \-a
Enable extended attributes. Write the uid/gid to the extended user
attributes r_uid and r_gid.
.TP
.B \-x
Pass \-x to rdup (stay in local filesystem).
.TP
.B \-z
Compress the files while backing up. This option
inserts \fBgzip.sh\fR in the pipeline. If both \fI-z\fR and
\fI-k\fR are given a file is first zipped and then encrypted.
.TP
.B \-e
Store the the timestamp and filelist files together with the backup.
This allows for backups to USB-drives and such. Normally they
are stored in `/etc/rdup'.

This option cannot be used when doing a remote backup.
.TP
.B \-v
Echo the files processed to standard error.
.TP
.B \-h
Show a short help message.
.TP
.B \-V
Show the version.

.SH EXAMPLES
.SS LOCAL BACKUP 
Dumping my homedir to the backup:

        dump.sh ~

Dumping /var/lib to the backup:
        
        dump.sh /var/lib
      
.SS REMOTE BACKUP
Dumping my homedir to the remote backup:

        dump.sh -c miekg@remote ~

Dumping /home to the remote backup:
        
        dump.sh -c miekg@remote /home

.SH FILES
/vol/backup/`hostname`, or the directory specified with \-b, root of
the backup file system.

.SH SEE ALSO
hist.sh(1), yesterday.sh(1) and rdup(8).
