'\" t
.TH DUMP.SH 8 "14 Mar 2006" "@PACKAGE_VERSION@" "@PACKAGE_NAME@ utils"

.SH NAME
dump.sh \- dump a filesystem for a specifc host

.SH SYNOPSIS
.B dump.sh
[
.IR OPTIONS
]
NAME
DIR|FILE
[
DIR|FILE
]

.SH DESCRIPTION
\fBdump.sh\fR is a frontend for `mirror.sh' and `rdup'. It will backup
all directories and files given on the command line. It tries to be smart with
respect to a full dump or an incremental dump. If the directories to
be backed up \fIdo not exist\fR in the backup directory a full dump
is assumed. Otherwise an incremental dump is performed.
.PP
Making local backups is as simple as:
      dump.sh $HOSTNAME ~ 
.PP
The \fBNAME\fR argument speficies a prefix for the
timestamp and filelist files. These are stored, by default, in
`@sysconfdir@/rdup'. With the \fB\-e\fR option you can store them
with your backup. 

If you use multiple \fBdump.sh\fR commands
they should have an unique \fINAME\fR argument. 

Furher more, \fINAME\fR has no relevance to the actual backup, this
is determined by the directories you backup.
.PP
.PP
\fBDIR\fR is the directory to be backed up. Multiple directories
are allowed on the command line.
.PP
The default backup location is `/vol/backup/`hostname''.
.PP
See mirror.sh(8) for more information on how the files are placed
in the backup.

.SH OPTIONS
.TP 
.B \-b backupdir
Alternate backup directory. Defaults to /vol/backup/`hostname`. The
current date in the format YYYYMM is added automatically.
.TP
.B \-c user@remotehost
Restore a backup on a remote host. This will create a pipeline of the
form: 

rdup \-c \fIDIR|FILE\fR | ssh \fIuser@remotehost\fR mirror.sh \-c \-b \fIbackupdir\fR

There is no provisioning for \fBssh\fR so unless you have configured
\fBssh\fR to work without a passphrase you will be asked to supply one.
Also note that the PATH on the remote host should be set in such a way that all
the rdup-util scripts can be found.
.TP
.B \-k keyfile
Encrypt the files while backing up with \fIkeyfile\fR. This option
inserts \fBcrypt.sh keyfile\fR in the pipeline. If both \fI-z\fR and
\fI-k\fR are given a file is first zipped and then encrypted.
.TP
.B -l num
Limit the transfer to 'num' bytes/second. This option is given to 
\fBcstream\fR. See the manual page of cstream at the \-t option.
.TP
.B \-a
Enable extended attributes. Write the uid/gid to the extended user
attributes r_uid and r_gid.
.TP
.B \-z
Compress the files while backing up. This option
inserts \fBgzip.sh\fR in the pipeline. If both \fI-z\fR and
\fI-k\fR are given a file is first zipped and then encrypted.
.TP
.B \-e
Store the the timestamp and filelist files together with the backup.
This allows for backups to USB-drives and such. Normally they
are stored in `/etc/rdup'.

This option cannot be used when doing a remote backup.
.TP
.B \-v
Echo the files processed to standard error.
.TP
.B \-h
Show a short help message.
.TP
.B \-V
Show the version.

.SH EXAMPLES
.SS LOCAL BACKUP 
Dumping my homedir to the backup:

        dump.sh MIEK ~

Dumping /home to the backup:
        
        dump.sh ALL /home
      
.SS REMOTE BACKUP
Dumping my homedir to the remote backup:

        dump.sh -c miekg@remote MIEK ~

Dumping /home to the remote backup:
        
        dump.sh -c miekg@remote ALL /home

.SH FILES
/vol/backup/`hostname`, or the directory specified with \-b, root of
the backup file system.

.SH SEE ALSO
hist.sh(1), yesterday.sh(1) and rdup(8).
