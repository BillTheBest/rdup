'\" t
.TH RDUP-SIMPLE 1 "29 Apr 2007" "@PACKAGE_VERSION@" "@PACKAGE_NAME@ utils"

.SH NAME
rdup-simple \- create a hard linked backup

.SH SYNOPSIS
.B rdup-simple
[
.B +DAYS
]
[
.IR OPTION
]
DIR|FILE
[
DIR|FILE
]
DESTINATION

.SH DESCRIPTION
\fBrdup-simple\fR is a front end for `rdup-snap' and `rdup'. It will backup
all directories and files given on the command line. It will create a
hard linked backup directory structure under the specified directory.
.PP
With the optional +DAYS argument you can specify how far backup
\fBrdup-simple\fR looks back for previous backups. This should
be a number in the range 1..99. It defaults to 8 days.
.PP
\fBrdup-simple\fR will create the directory `~/.rdup' and will
store its administrative files there. 
.PP
This program does not need to be run with root permissions.
.PP
The last argument of \fBrdup-simple\fR is used as the destination.
.PP
For the naming of the files in `~/.rdup' the destination 
argument is taken and hashed some what. If a destination equals
a previous destination the internal book keeping files for 
that destination are used by \fBrdup-simple\fR. Note that
\fBrdup-simple\fR does not check what encryption and/or compression
options you may have used for a previous backup. If you naively forget
to provide a '-k KEY' option to a new backup run, those files will be
put in your backup file system without encryption.

The following destinations are supported:
.TP
.B ssh://user@host/directory
Use `ssh' as a protocol and `user` as the remote user name. Store
the backup in `directory` on the remote server `host'.

Note: when doing a remove backup as a normal ssh user the ownership
of the backup is not preserved on the remove host. All files and
directories will belong to 'user'. See the -a flag for a work around.

.TP 
.B ssh://host/directory
Use `ssh' as a protocol and the current user name as the remote user name. Store
the backup in `directory` on the remote server `host'.

.TP
.B file:///directory
Use `/directory` to store the backup, `file://` is optional. Note: there
are 3 slashes here.
.TP
.B /directory
Use `/directory` to store the backup. 
.TP
.B directory
Use `directory` in the current directory for the backup.

.PP
Also note that if you use \fBfile:///vol/backup\fR as the destination and later
start using \fB/vol/backup\fR that these two represent two different
backups and will have there own set of timestamp and file list files.

.SS Making a backup
Making a backup is as simple as:
.RS
rdup-simple ~ /adm /vol/backup/$HOSTNAME
.RE
.PP
\fB~\fR and \fB/adm\fR are the directories to be backed up. Multiple directories
or files are allowed on the command line.
.PP
The backup will be stored in `/vol/backup/$HOSTNAME`.

.PP
For the backup a YYYYMM directory is created. In this directory
specific day-dumps are placed. So the first dump in October 2006,
will created in 200610/01 and the second in 200610/02, etc.
.PP
You can use incremental dumps forever, there is no need to do
a full dump every once in a while.
.PP
Note that \fBrdup-simple\fR calls \fBrdup-snap-link\fR. This small
utility will actually hardlink copy the previous backup. The return
value of \fBrdup-snap-link\fR will determine if a full or incremental 
dump will be performed.

.SS Remote backups
.RS
rdup-simple ~ /adm ssh://miekg@remote/vol/backup/$HOSTNAME
.RE
Note: for remote backups to work, the receiving machine must have \fBrdup\fR installed.
Also note: there is no colon between the hostname and the directory.
Remote backup will create a pipeline of the form:

rdup \-c \fIDIR|FILE\fR | ssh \fIuser@remotehost\fR rdup-snap \-c \-b \fIbackupdir\fR

There is no provisioning for \fBssh\fR so unless you have configured
\fBssh\fR to work without a passphrase you will be asked to supply one.
Also note that the PATH on the remote host should be set in such a way that all
the rdup-util scripts can be found.

.SH OPTIONS
.B \-k keyfile
Encrypt the files while backing up with \fIkeyfile\fR. This option
inserts \fBrdup-crypt keyfile\fR in the pipeline. 
.TP
.B \-a
Enable extended attributes. Write the uid/gid to the extended user
attributes r_uid and r_gid.
.TP
.B \-f
Force a full dump.
.TP
.B \-g
GPG encrypt the files. This option inserts \fBrdup-gpg\fR in the
pipeline. Note that when you need to restore you will be prompted
for your GPG passphrase for \fIevery\fR encrypted file! Unless you
have configured `gpg-agent`. See the \fI\-a\fR flag of
\fBrdup-restore\fR.
.TP
.B \-x
See \-x in rdup(1).
.TP
.B \-z
Compress the files while backing up. This option
inserts \fBrdup-gzip\fR in the pipeline. 
.TP
.B \-v
Echo the files processed to standard error.
.TP
.B \-H
Make hourly backups. The backup directory will be extended with a hour
string: YYYY/MM/HH.
.TP
.B \-h
Show a short help message.
.TP
.B \-V
Show the version.

.SH SEE ALSO
rdup(1) and rdup-snap-link(1). See rdup-backups(1) for
examples and an introduction into making backups with \fBrdup\fR. Look
at rdup-restore(1) for help on restoring.
