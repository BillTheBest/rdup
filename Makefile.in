OBJ=crawler.o rdup.o gfunc.o
HDR=rdup.h 
SHS=mirror/mirror.sh excl.sh mirror/hist.sh mirror/yesterday.sh remote/sftp.sh \
remote/catch.sh remote/throw.sh 
MAN=doc/mirror.sh.8 doc/hist.sh.1 doc/yesterday.sh.1 doc/catch.sh.1 doc/throw.sh.1

prefix  = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
sbindir = @sbindir@
mandir = @mandir@
sysconfdir = @sysconfdir@

GCC = @CC@
GLIB_CFLAGS     = @GLIB_CFLAGS@
GLIB_LIBS       = @GLIB_LIBS@
CFLAGS =-Wall -Wextra @CFLAGS@ @DEFS@ -Os -D_FILE_OFFSET_BITS=64 -D_LARGE_FILES -Wpointer-arith -Wstrict-prototypes
INSTALL = ./install-sh -c
INSTALL_DATA = $(INSTALL) -m 644

.PHONY:	clean install all uninstall

%.o:    %.c ${HDR}
	${GCC} ${CFLAGS} ${GLIB_CFLAGS} -c $<

all:	rdup

rdup:	${OBJ} ${HDR} 
	${GCC} ${GLIB_LIBS} ${OBJ} -o rdup
	strip rdup
	chmod +x $(SHS)

clean:
	rm -f *.o
	rm -f rdup

realclean: clean
	rm -rf autom4te.cache
	rm -f config.log
	rm -f config.status
	rm -f config.h
	rm -f rdup.h
	rm -f rdup*.tar.bz2
	rm -f rdup*.tar.bz2.sha1
	rm -f ${SHS}
	rm -f ${MAN}

distclean: realclean
	rm -f configure
	rm -f Makefile
	rm -f *.tar.bz2
	rm -f *.tar.gz

install: rdup 
	mkdir -p ${DESTDIR}${sysconfdir}/rdup
	mkdir -p ${DESTDIR}${mandir}/man1
	mkdir -p ${DESTDIR}${mandir}/man8
	${INSTALL} rdup ${DESTDIR}${sbindir}/rdup
	${INSTALL} mirror/yesterday.sh ${DESTDIR}${bindir}/yesterday
	${INSTALL} mirror/hist.sh ${DESTDIR}${bindir}/hist
	${INSTALL} mirror/mirror.sh ${DESTDIR}${sbindir}/mirror
	${INSTALL} remote/sftp.sh ${DESTDIR}${sbindir}/sftp.sh
	${INSTALL} remote/throw.sh ${DESTDIR}${sbindir}/throw.sh
	${INSTALL} remote/catch.sh ${DESTDIR}${sbindir}/catch.sh
	${INSTALL_DATA} shared.sh ${DESTDIR}${sysconfdir}/rdup/shared.sh
	${INSTALL_DATA} rdup.8 ${DESTDIR}${mandir}/man8/rdup.8
	${INSTALL_DATA} doc/mirror.sh.8 ${DESTDIR}${mandir}/man8/mirror.8
	${INSTALL_DATA} doc/yesterday.sh.1 ${DESTDIR}${mandir}/man1/yesterday.1
	${INSTALL_DATA} doc/hist.sh.1 ${DESTDIR}${mandir}/man1/hist.1
	${INSTALL_DATA} doc/catch.sh.1 ${DESTDIR}${mandir}/man1/catch.sh.1
	${INSTALL_DATA} doc/throw.sh.1 ${DESTDIR}${mandir}/man1/throw.sh.1

uninstall:
	rm -f ${DESTDIR}${sbindir}/rdup
	rm -f ${DESTDIR}${bindir}/yesterday
	rm -f ${DESTDIR}${bindir}/hist
	rm -f ${DESTDIR}${sbindir}/mirror
	rm -f ${DESTDIR}${sbindir}/sftp.sh
	rm -f ${DESTDIR}${sysconfdir}/rdup/shared.sh
	rm -f ${DESTDIR}${mandir}/man8/rdup.8
	rm -f ${DESTDIR}${mandir}/man8/bmirror.8
	rm -f ${DESTDIR}${mandir}/man1/yesterday.1
	rm -f ${DESTDIR}${mandir}/man1/hist.1
	rm -f ${DESTDIR}${mandir}/man1/catch.sh.1
	rm -f ${DESTDIR}${mandir}/man1/throw.sh.1
