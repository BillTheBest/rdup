#!/bin/bash

# create a hardlinked backup
# this scripts figures out if the
# dump is incremental or full. And makes a copy
# of the previous backup with GNU cp

prefix=@prefix@
datarootdir=@datarootdir@
exec_prefix=@exec_prefix@
datadir=@datadir@/rdup
sysconfdir=@sysconfdir@/rdup
GNU_DEFS=rdup-snapshot.gnu

# shared stuff
. $datadir/shared.sh
if [[ -r $sysconfdir/$GNU_DEFS ]]; then
        source $sysconfdir/$GNU_DEFS
fi
if [[ -z $GNU_DATE ]]; then
        GNU_DATE=date
fi
if [[ -z $GNU_CP ]] ;then
        GNU_CP=cp
fi

usage() {
	cat << HELP
$PROGNAME [-H] DAYS BACKUPDIR NOW

This is a small shell script that hard links directories
Its purpose is to be used from within rdup-simple

-H	     include the hour in the backup directory

DAYS       - look backup DAYS days for previous dumps
	     with -H this calculates in hours
BACKUPDIR  - where to backup to
NOW        - Current date in YYYYMM format
             With -H, current date in YYYYMM/HH format
HELP
}

# before setting the progname, check if we are called by something name
# rdup-simple. $PROGNAME is exported by rdup-simple
if [ "$PROGNAME" != "rdup-simple" ]; then
    PROGNAME=$0; # so the error is ok
    _echo2 "Can only be called from rdup-simple"
    exit 2
fi

PROGNAME=$0
# parse our only option
getopts "H" hour;
if [[ $hour == "H" ]]; then
    hour=true;
    shift;
else
    hour=false
fi

if [[ $# -ne 3 ]]; then
        usage
        exit 2
fi

what $1 $2 $3
exit $?
