#!/bin/bash
#
# Copyright (c) 2005, 2006 Miek Gieben
# See LICENSE for the license
#
# inspired by yesterday of plan9

. @sysconfdir@/rdup/shared.sh

tool_defines
tool_cmd_options $@
shift $(($OPTIND - 1))
# tool_dirdate don't add date, recent handle this

for file in $@
do
        if [[ -z $file ]]; then
                continue
        fi
        if [[ ${file:0:1} != "/" ]]; then
                file=`pwd`/$file
        fi
        backupfile=`recent $daysago $file`

        # print
        if [[ $copy -eq 1 ]]; then
                cp -a $backupfile $file
                continue
        fi
        if [[ $Ccopy -eq 1 ]]; then
                cmp $backupfile $file > /dev/null
                if [[ $? ]]; then
                        cp -a $backupfile $file
                fi
                continue
        fi
        if [[ $diff -eq 1 ]]; then
                echo diff -u `basename $backupfile` `basename $file`
                if [[ $gzip -eq 1 ]]; then
                [[ ! -d $backupfile ]] && \
zcat $backupfile | diff -u - $file
                         continue;
                fi
                [[ ! -d $backupfile ]] && diff -u $backupfile $file
                continue
        fi

        echo $backupfile
done
