OBJ=crawler.o rdup.o gfunc.o getdelim.o signal.o usage.o sha1.o regexp.o abspath.o link.o reverse.o
OBJ_TR=rdup-tr.o signal.o getdelim.o archive.o usage-tr.o child.o
HDR=rdup.h
CMD=rdup
MAN1_IN=rdup.1 rdup-tr.1

MAN1=$(addprefix doc/, $(MAN1_IN))

prefix=@prefix@
exec_prefix=@exec_prefix@
datarootdir=@datarootdir@
localedir=@localedir@
bindir=@bindir@
sbindir=@sbindir@
mandir=@mandir@
sysconfdir=@sysconfdir@
datadir=@datadir@/rdup

GCC=@CC@
GLIB_CFLAGS=@GLIB_CFLAGS@
GLIB_LIBS=@GLIB_LIBS@
LIBS=@LIBS@
DRACE=-D_DEBUG_RACE
CFLAGS=-Wall -W -Werror @CFLAGS@ @DEFS@ -DLOCALEROOTDIR=\"@localedir@\" -Os -D_FILE_OFFSET_BITS=64 -D_LARGE_FILES -Wpointer-arith -Wstrict-prototypes
#CFLAGS=-Wall -W @CFLAGS@ @DEFS@ -Os $(DRACE) -D_FILE_OFFSET_BITS=64 -D_LARGE_FILES -Wpointer-arith -Wstrict-prototypes
INSTALL=./install-sh -c
INSTALL_DATA=$(INSTALL) -m 644

.PHONY:	all clean install all uninstall

%.o:    %.c ${HDR}
	${GCC} ${CFLAGS} ${GLIB_CFLAGS} -c $<

all:	rdup rdup-tr

rdup-tr: $(OBJ_TR) $(HDR)
	${GCC} ${GLIB_LIBS} ${LIBS} ${OBJ_TR} -o rdup-tr

rdup:	${OBJ} ${HDR} 
	${GCC} ${GLIB_LIBS} ${LIBS} ${OBJ} -o rdup

po:	rdup.pot 
	( cd po ; make -f GNUmakefile all )

rdup.pot:
	xgettext --omit-header -k_ -d rdup -s -o rdup.pot *.c 
	xgettext -j -Lperl -kget -d rdup -s -o rdup.pot pl-tools/*.in

clean:
	rm -f *.o
	rm -f rdup rdup.mo
	( cd po ; make -f GNUmakefile clean )

realclean: clean
	rm -rf autom4te.cache
	rm -f config.log
	rm -f config.status
	rm -f config.h
	rm -f rdup.h
	rm -f rdup*.tar.bz2
	rm -f rdup*.tar.bz2.sha1
	rm -f ${MAN1}
	rm -f ${PRL}
	rm -f ${WRP}
	make -C po realclean

distclean: 

install: all
	mkdir -p ${DESTDIR}${mandir}/man1
	mkdir -p ${DESTDIR}${datadir}
	for i in ${CMD}; do ${INSTALL} $$i ${DESTDIR}${bindir}/$$i ; done
	for i in ${MAN1}; do [ -f $$i ] &&  ${INSTALL_DATA} $$i ${DESTDIR}${mandir}/man1/`basename $$i` ; done; exit 0
	make -C po install

uninstall:
	for i in ${CMD}; do rm -f ${DESTDIR}${bindir}/$$i ; done
	for i in ${MAN1}; do rm -f  ${DESTDIR}${mandir}/man1/`basename $$i` ; done
	make -C po uninstall
